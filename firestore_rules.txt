rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ğŸ” FUNÃ‡ÃƒO AUXILIAR - Verificar se usuÃ¡rio Ã© admin
    function isAdmin() {
      return request.auth != null &&
        request.auth.token.email.lower() in [
          'lorenalessa90@gmail.com',
          'admin@finwise.com'
        ];
    }

    // ğŸ‘‘ SUPER ADMIN - Apenas vocÃª pode modificar configuraÃ§Ãµes do sistema
    function isSuperAdmin() {
      return request.auth != null &&
        request.auth.token.email.lower() == 'lorenalessa90@gmail.com';
    }

    // ğŸ‘‘ CONFIGURAÃ‡Ã•ES DO SISTEMA - APENAS SUPER ADMIN
    match /config/{configId} {
      // Todos podem ler configuraÃ§Ãµes pÃºblicas
      allow read: if true;

      // APENAS SUPER ADMIN pode modificar configuraÃ§Ãµes
      allow write: if isSuperAdmin();
    }

    // ï¿½ USUÃRIOS - Regras bÃ¡sicas de seguranÃ§a
    match /users/{userId} {
      // Permitir leitura para usuÃ¡rios autenticados OU PARA DESENVOLVIMENTO (temporÃ¡rio)
      allow read: if request.auth != null || true; // TEMPORÃRIO: permitir leituras nÃ£o autenticadas

      // Permitir criaÃ§Ã£o de conta prÃ³pria
      allow create: if request.auth != null &&
        request.auth.uid == userId;

      // Permitir atualizaÃ§Ã£o apenas para o prÃ³prio usuÃ¡rio OU admins
      allow update: if request.auth != null && (
        request.auth.uid == userId ||
        isAdmin()
      );

      // NUNCA permitir delete de usuÃ¡rios
      allow delete: if false;
    }

    // ğŸ“Š TRANSAÃ‡Ã•ES - Privadas por usuÃ¡rio
    match /users/{userId}/transactions/{transactionId} {
      // Apenas o dono pode ler/escrever suas transaÃ§Ãµes
      allow read, write: if request.auth != null &&
        request.auth.uid == userId;
    }

    // ğŸ“ ARQUIVOS - Privados por usuÃ¡rio
    match /users/{userId}/files/{fileId} {
      allow read, write: if request.auth != null &&
        request.auth.uid == userId;
    }

    // âš™ï¸ CONFIGURAÃ‡Ã•ES DO APP - Apenas leitura pÃºblica
    match /app_config/{configId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // ğŸ“ˆ ESTATÃSTICAS - Apenas admins podem ler
    match /analytics/{analyticId} {
      allow read, write: if isAdmin();
    }

    // ğŸ”’ LOGS DE ADMIN - Apenas admins
    match /admin_logs/{logId} {
      allow read, write: if isAdmin();
    }
  }
}